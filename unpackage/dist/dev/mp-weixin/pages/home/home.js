"use strict";var e=require("../../common/vendor.js");Array||e.resolveComponent("uni-icons")();const h=()=>"../../uni_modules/uni-icons/components/uni-icons/uni-icons.js";Math||h();const y={__name:"home",setup(g){const n=e.ref(e.index.getStorageSync("token")),r=e.ref([]),o=e.ref([]),u=e.ref(0),c=e.ref(0),l=e.ref(0),d=async()=>{await e.index.getUserProfile({desc:"\u7528\u4E8E\u5B8C\u5584\u7528\u6237\u4FE1\u606F",success:a=>{r.value=a.userInfo},fail:a=>{console.log(a)}})},v=()=>{e.pn.callFunction({name:"userInfo",data:{api:"getUserInfo",token:n.value}}).then(a=>{o.value=a.result,m(o.value._id),f(o.value._id),p(o.value._id),e.index.hideLoading(),console.log(a.result)}).catch(a=>{e.index.hideLoading(),e.index.showToast({title:"\u83B7\u53D6\u7528\u6237\u4FE1\u606F\u5931\u8D25",icon:"error"})})},i=e.pn.database(),m=a=>{i.collection("message").where(`userId == "${a}"`).groupBy("userId").groupField("sum(1) as messageCount").get().then(t=>{const s=t.result.data[0];u.value=s.messageCount,console.log(u.value)})},f=a=>{i.collection("message").where(`userId == "${a}"`).groupBy("userId").groupField("sum(likeNumber) as userLikeCount").get().then(t=>{const s=t.result.data[0];c.value=s.userLikeCount,console.log(c.value)})},p=a=>{i.collection("user").where(`_id == "${a}"`).get().then(t=>{const s=t.result.data[0],_=e.dayjs(s.createdAt).format("YYYY-MM-DD HH:mm:ss");l.value=e.dayjs().diff(e.dayjs(_),"day"),console.log(l.value)})};return e.onLoad(()=>{e.index.showLoading(),v()}),e.watch(()=>r.value,()=>{e.pn.callFunction({name:"userInfo",data:{api:"updateUserInfo",nickName:r.value.nickName,avatarUrl:r.value.avatarUrl,token:n.value}}).then(a=>{e.index.showLoading(),console.log("\u4FEE\u6539\u4FE1\u606F\u6210\u529F",a),v()})},{deep:!0}),(a,t)=>e.e({a:e.p({type:"gear",size:"20"}),b:e.o(s=>d()),c:n.value&&o.value.avatarUrl},n.value&&o.value.avatarUrl?{d:o.value.avatarUrl,e:e.o(s=>d())}:{},{f:n.value&&o.value.nickName},n.value&&o.value.nickName?{g:e.t(o.value.nickName)}:{},{h:e.p({color:"#004dfc",type:"calendar",size:"24"}),i:e.t(l.value),j:e.p({color:"#00ba9d",type:"medal",size:"24"}),k:e.p({color:"#715fc2",type:"chat",size:"24"}),l:e.t(u.value),m:e.p({color:"#ff562d",type:"star",size:"24"}),n:e.t(c.value)})}};var k=e._export_sfc(y,[["__file","/Users/huangqiang/Documents/HBuilderProjects/iihao/pages/home/home.vue"]]);wx.createPage(k);
